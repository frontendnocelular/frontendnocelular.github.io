<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conectados pela Luz</title>
  <meta name="description" content="Uma experiência interativa visual e sonora - Conectados pela Luz">
  <style>
    :root {
      --primary-color: #0d1b2a;
      --secondary-color: #ff4081;
      --accent-color: #fff;
      --water-color: #061d2e;
      --moon-size: clamp(80px, 12vw, 120px);
      --boat-size: clamp(60px, 10vw, 80px);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: radial-gradient(circle at center, var(--primary-color) 0%, #000 100%);
      overflow: hidden;
      height: 100vh;
      font-family: 'Georgia', serif;
      color: var(--accent-color);
      position: relative;
      cursor: none;
      user-select: none;
    }

    /* Cursor personalizado otimizado */
    .cursor {
      position: fixed;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, rgba(255,255,255,0.8), transparent);
      border-radius: 50%;
      pointer-events: none;
      z-index: 9999;
      transform: translate(-50%, -50%);
      transition: transform 0.15s ease;
      will-change: transform;
    }

    .cursor.clicked {
      transform: translate(-50%, -50%) scale(1.5);
    }

    /* Gradiente dinâmico otimizado */
    .background-gradient {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, 
                  rgba(13, 27, 42, 0.9) 0%, 
                  rgba(0, 0, 0, 1) 70%);
      z-index: -2;
      transition: background 0.3s ease;
      will-change: background;
    }

    /* Mar com animação otimizada */
    .mar {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 40vh;
      background: linear-gradient(to top, var(--water-color) 0%, rgba(6, 29, 46, 0.8) 50%, transparent 100%);
      animation: ondas 4s infinite ease-in-out;
      z-index: 1;
      will-change: transform;
    }

    .mar::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: reflexoAgua 6s infinite ease-in-out;
      will-change: transform;
    }

    @keyframes ondas {
      0%, 100% { transform: translateY(0) scaleY(1); }
      50% { transform: translateY(1vh) scaleY(0.98); }
    }

    @keyframes reflexoAgua {
      0%, 100% { transform: translateX(-100%); }
      50% { transform: translateX(100%); }
    }

    /* Lua otimizada */
    .lua {
      position: absolute;
      top: 10vh;
      left: 50%;
      width: var(--moon-size);
      height: var(--moon-size);
      margin-left: calc(-0.5 * var(--moon-size));
      background: radial-gradient(circle at 30% 30%, #fff, #e6e6e6, #ccc);
      border-radius: 50%;
      box-shadow: 0 0 clamp(20px, 4vw, 40px) rgba(255,255,255,0.8),
                  0 0 clamp(40px, 8vw, 80px) rgba(255,255,255,0.3);
      opacity: 0;
      animation: aparecerLua 3s forwards ease-in, pulsarLua 8s infinite ease-in-out 3s;
      cursor: pointer;
      z-index: 5;
      transition: transform 0.3s ease;
      will-change: transform, box-shadow;
    }

    .lua:hover {
      transform: scale(1.05);
    }

    .lua::before {
      content: "";
      position: absolute;
      top: 20%;
      left: 20%;
      width: 15%;
      height: 15%;
      background: rgba(200,200,200,0.6);
      border-radius: 50%;
    }

    .lua::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 60%;
      width: 8%;
      height: 8%;
      background: rgba(180,180,180,0.4);
      border-radius: 50%;
    }

    @keyframes aparecerLua {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      100% { transform: scale(1) rotate(360deg); opacity: 1; }
    }

    @keyframes pulsarLua {
      0%, 100% { 
        box-shadow: 0 0 clamp(20px, 4vw, 40px) rgba(255,255,255,0.8),
                    0 0 clamp(40px, 8vw, 80px) rgba(255,255,255,0.3);
      }
      50% { 
        box-shadow: 0 0 clamp(30px, 6vw, 60px) rgba(255,255,255,1),
                    0 0 clamp(60px, 12vw, 120px) rgba(255,255,255,0.5);
      }
    }

    /* Barco otimizado */
    .barco {
      position: absolute;
      bottom: 20vh;
      left: 50%;
      width: var(--boat-size);
      height: calc(var(--boat-size) * 0.625);
      margin-left: calc(-0.5 * var(--boat-size));
      animation: flutuar 3s infinite ease-in-out;
      z-index: 3;
      cursor: pointer;
      transition: transform 0.3s ease;
      will-change: transform;
    }

    .barco:hover {
      transform: scale(1.1);
    }

    .barco::before {
      content: "";
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 40%;
      background: linear-gradient(to bottom, #4a4a4a, #2a2a2a);
      border-radius: 0 0 40px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .barco::after {
      content: "";
      position: absolute;
      bottom: 35%;
      left: 50%;
      width: 2px;
      height: 60%;
      background: linear-gradient(to top, #8B4513, #D2691E);
      transform: translateX(-50%);
    }

    .boneco {
      position: absolute;
      bottom: 40%;
      left: 50%;
      width: clamp(8px, 1.5vw, 12px);
      height: clamp(15px, 3vw, 20px);
      background: linear-gradient(to bottom, #fff, #e6e6e6);
      border-radius: 5px;
      transform: translateX(-50%);
      animation: respirar 2s infinite ease-in-out;
      will-change: transform;
    }

    .boneco::before {
      content: "";
      position: absolute;
      top: -60%;
      left: 50%;
      width: clamp(12px, 2vw, 16px);
      height: clamp(12px, 2vw, 16px);
      background: radial-gradient(circle, #fff, #f0f0f0);
      border-radius: 50%;
      transform: translateX(-50%);
    }

    @keyframes flutuar {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-0.5vh) rotate(1deg); }
    }

    @keyframes respirar {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.05); }
    }

    /* Reflexo da lua otimizado */
    .reflexo-lua {
      position: absolute;
      bottom: 0;
      left: 50%;
      width: clamp(20px, 3vw, 30px);
      height: 35vh;
      margin-left: calc(-0.5 * clamp(20px, 3vw, 30px));
      background: linear-gradient(to bottom, 
                  rgba(255,255,255,0.6) 0%,
                  rgba(255,255,255,0.3) 30%,
                  rgba(255,255,255,0.1) 60%,
                  transparent 100%);
      animation: reflexoLua 4s infinite ease-in-out;
      z-index: 2;
      will-change: opacity, transform;
    }

    @keyframes reflexoLua {
      0%, 100% { opacity: 0.8; transform: scaleX(1); }
      50% { opacity: 1; transform: scaleX(1.2); }
    }

    /* Canvas para estrelas */
    .estrelas {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }

    /* Frases otimizadas */
    #frasesDexter {
      position: fixed;
      top: 60%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      text-align: center;
      font-size: clamp(1rem, 2.5vw, 1.3rem);
      line-height: 1.8;
      color: var(--accent-color);
      padding: 20px;
      opacity: 0;
      transition: opacity 2s ease-in-out;
      font-family: 'Georgia', serif;
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
      z-index: 10;
      will-change: opacity;
    }

    /* Controles otimizados */
    .btn-controls {
      position: fixed;
      display: flex;
      gap: 10px;
      top: 20px;
      right: 20px;
      z-index: 100;
    }

    .btn {
      padding: clamp(8px, 2vw, 12px);
      font-size: clamp(16px, 3vw, 20px);
      background: rgba(0,0,0,0.6);
      color: white;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      will-change: transform;
    }

    .btn:hover, .btn:focus {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255,255,255,0.5);
      outline: none;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .botao-luz {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: clamp(10px, 2vw, 15px) clamp(15px, 3vw, 20px);
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      background: linear-gradient(135deg, var(--secondary-color), #ff6b9d);
      color: white;
      border: none;
      border-radius: 30px;
      box-shadow: 0 0 20px rgba(255, 64, 129, 0.6);
      cursor: pointer;
      z-index: 20;
      transition: all 0.3s ease;
      animation: pulsar 3s infinite ease-in-out;
      will-change: transform, box-shadow;
    }

    .botao-luz:hover, .botao-luz:focus {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255, 64, 129, 0.8);
      outline: none;
    }

    .botao-luz:active {
      transform: scale(0.95);
    }

    @keyframes pulsar {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 64, 129, 0.6); }
      50% { box-shadow: 0 0 30px rgba(255, 64, 129, 1); }
    }

    /* Modais otimizados */
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 90%;
      max-width: 500px;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid rgba(255,255,255,0.3);
      padding: clamp(20px, 4vw, 30px);
      color: var(--accent-color);
      text-align: center;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 30px rgba(255,255,255,0.3);
      z-index: 999;
      animation: aparecer 0.6s ease forwards;
      will-change: transform, opacity;
    }

    .modal.close {
      animation: desaparecer 0.6s ease forwards;
    }

    @keyframes aparecer {
      0% { opacity: 0; transform: scale(0.8) translate(-62.5%, -62.5%); }
      100% { opacity: 1; transform: scale(1) translate(-50%, -50%); }
    }

    @keyframes desaparecer {
      0% { opacity: 1; transform: scale(1) translate(-50%, -50%); }
      100% { opacity: 0; transform: scale(0.8) translate(-62.5%, -62.5%); }
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5rem;
      cursor: pointer;
      color: rgba(255,255,255,0.7);
      transition: color 0.3s ease;
      background: none;
      border: none;
    }

    .close-btn:hover, .close-btn:focus {
      color: var(--accent-color);
      outline: none;
    }

    /* Canvas para coração */
    #coracaoCanvas {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100vw;
      height: 100vh;
      display: none;
      z-index: 15;
    }

    /* Efeitos de partículas otimizados */
    .particle {
      position: fixed;
      width: 4px;
      height: 4px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      pointer-events: none;
      z-index: 5;
      will-change: transform, opacity;
    }

    /* Ondas de clique otimizadas */
    .click-wave {
      position: fixed;
      border: 2px solid rgba(255,255,255,0.6);
      border-radius: 50%;
      pointer-events: none;
      z-index: 50;
      animation: wave 0.6s ease-out forwards;
      will-change: transform, opacity;
    }

    @keyframes wave {
      0% {
        width: 0;
        height: 0;
        opacity: 1;
      }
      100% {
        width: 100px;
        height: 100px;
        opacity: 0;
      }
    }

    /* Responsividade melhorada */
    @media (max-width: 768px) {
      .btn-controls {
        top: 10px;
        right: 10px;
        gap: 5px;
      }

      .botao-luz {
        bottom: 10px;
        right: 10px;
      }

      #frasesDexter {
        top: 65%;
        width: 95%;
      }
    }

    @media (max-width: 480px) {
      .lua {
        top: 8vh;
      }

      .barco {
        bottom: 18vh;
      }

      .modal {
        width: 95%;
        padding: 15px;
      }
    }

    @media (orientation: landscape) and (max-height: 500px) {
      .lua {
        top: 5vh;
      }

      .barco {
        bottom: 15vh;
      }

      #frasesDexter {
        top: 70%;
        font-size: clamp(0.8rem, 2vw, 1rem);
      }
    }

    /* Acessibilidade */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Estados de foco para acessibilidade */
    .lua:focus,
    .barco:focus {
      outline: 2px solid rgba(255,255,255,0.8);
      outline-offset: 4px;
    }

    /* Loading screen */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, var(--primary-color) 0%, #000 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      transition: opacity 1s ease;
    }

    .loading.hide {
      opacity: 0;
      pointer-events: none;
    }

    .loading-text {
      color: var(--accent-color);
      font-size: clamp(1.2rem, 3vw, 1.8rem);
      animation: loading-pulse 2s infinite ease-in-out;
    }

    @keyframes loading-pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading" id="loading">
    <div class="loading-text">Conectando...</div>
  </div>

  <!-- Cursor personalizado -->
  <div class="cursor" id="cursor"></div>
  
  <!-- Gradiente de fundo -->
  <div class="background-gradient" id="backgroundGradient"></div>
  
  <!-- Texto das frases -->
  <div id="frasesDexter" role="status" aria-live="polite"></div>
  
  <!-- Elementos da cena -->
  <div class="lua" id="lua" tabindex="0" role="button" aria-label="Lua interativa"></div>
  <div class="reflexo-lua" aria-hidden="true"></div>
  <div class="mar" aria-hidden="true"></div>

  <div class="barco" id="barco" tabindex="0" role="button" aria-label="Barco interativo">
    <div class="boneco" aria-hidden="true"></div>
  </div>

  <!-- Canvas para estrelas -->
  <canvas class="estrelas" id="estrelas" aria-hidden="true"></canvas>

  <!-- Controles -->
  <div class="btn-controls" role="toolbar" aria-label="Controles da aplicação">
    <button class="btn" id="btn-audio" aria-label="Controle de áudio">🔈</button>
    <button class="btn" id="btn-fullscreen" aria-label="Tela cheia">⛶</button>
    <button class="btn" id="btn-pause" aria-label="Pausar animações">⏸️</button>
  </div>

  <button id="btn-luz" class="botao-luz" aria-label="Enviar luz para alguém">💌 Enviar essa luz para alguém</button>

  <!-- Canvas para coração -->
  <canvas id="coracaoCanvas" aria-hidden="true"></canvas>

  <!-- Modal para mensagem de luz -->
  <div id="mensagemLuz" class="modal" role="dialog" aria-labelledby="titulo-luz" aria-hidden="true">
    <button class="close-btn" id="closeLuz" aria-label="Fechar">&times;</button>
    <h3 id="titulo-luz">Luz Enviada</h3>
    <p id="textoLuz">Essa luz é para você, <strong>alguém especial</strong></p>
  </div>

  <!-- Áudio -->
  <audio id="audio-mar" loop preload="none" aria-label="Som do mar">
    <source src="data:audio/mpeg;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAMAAAAAADlgZ3AAAA==" type="audio/mpeg">
  </audio>

  <script>
    // Classe principal da aplicação
    class ConectadosPelaLuz {
      constructor() {
        this.isVisible = true;
        this.audioPlaying = false;
        this.animationsPaused = false;
        this.currentPhraseIndex = 0;
        this.mouseX = 50;
        this.mouseY = 50;
        
        this.init();
      }

      init() {
        this.setupElements();
        this.setupEventListeners();
        this.initializeStars();
        this.initializePhrases();
        this.hideLoading();
        
        console.log('🌙 Conectados pela Luz - Versão Otimizada');
        console.log('⌨️  Atalhos: Espaço(Pausar), M(Áudio), F(Tela cheia), L(Enviar luz), ESC(Fechar)');
      }

      setupElements() {
        this.cursor = document.getElementById('cursor');
        this.backgroundGradient = document.getElementById('backgroundGradient');
        this.audio = document.getElementById('audio-mar');
        this.btnAudio = document.getElementById('btn-audio');
        this.btnFullscreen = document.getElementById('btn-fullscreen');
        this.btnPause = document.getElementById('btn-pause');
        this.btnLuz = document.getElementById('btn-luz');
        this.lua = document.getElementById('lua');
        this.barco = document.getElementById('barco');
        this.frasesContainer = document.getElementById('frasesDexter');
        this.starsCanvas = document.getElementById('estrelas');
        this.starsCtx = this.starsCanvas.getContext('2d');
        this.heartCanvas = document.getElementById('coracaoCanvas');
        this.heartCtx = this.heartCanvas.getContext('2d');
        this.mensagemLuz = document.getElementById('mensagemLuz');
        this.textoLuz = document.getElementById('textoLuz');
        this.closeLuz = document.getElementById('closeLuz');
        this.loading = document.getElementById('loading');
      }

      setupEventListeners() {
        // Mouse e cursor
        document.addEventListener('mousemove', this.handleMouseMove.bind(this));
        document.addEventListener('mousedown', () => this.cursor.classList.add('clicked'));
        document.addEventListener('mouseup', () => this.cursor.classList.remove('clicked'));
        document.addEventListener('click', this.handleClick.bind(this));

        // Controles
        this.btnAudio.addEventListener('click', this.toggleAudio.bind(this));
        this.btnFullscreen.addEventListener('click', this.toggleFullscreen.bind(this));
        this.btnPause.addEventListener('click', this.toggleAnimations.bind(this));
        this.btnLuz.addEventListener('click', this.sendLight.bind(this));

        // Elementos interativos
        this.lua.addEventListener('click', this.handleMoonClick.bind(this));
        this.barco.addEventListener('click', this.handleBoatClick.bind(this));

        // Modais
        this.closeLuz.addEventListener('click', this.closeLightModal.bind(this));
        document.addEventListener('click', this.handleModalClick.bind(this));

        // Teclado
        document.addEventListener('keydown', this.handleKeydown.bind(this));

        // Touch para mobile
        document.addEventListener('touchstart', this.handleTouchStart.bind(this));
        document.addEventListener('touchend', this.handleTouchEnd.bind(this));

        // Redimensionamento e visibilidade
        window.addEventListener('resize', this.handleResize.bind(this));
        window.addEventListener('orientationchange', this.handleOrientationChange.bind(this));
        document.addEventListener('visibilitychange', this.handleVisibilityChange.bind(this));

        // Inicialização de áudio com primeira interação
        ['click', 'touchstart', 'keydown'].forEach(event => {
          document.addEventListener(event, this.initAudio.bind(this), { once: true });
        });
      }

      handleMouseMove(e) {
        this.cursor.style.left = e.clientX + 'px';
        this.cursor.style.top = e.clientY + 'px';
        
        this.mouseX = (e.clientX / window.innerWidth) * 100;
        this.mouseY = (e.clientY / window.innerHeight) * 100;
        
        this.backgroundGradient.style.background = `radial-gradient(circle at ${this.mouseX}% ${this.mouseY}%, rgba(13, 27, 42, 0.9) 0%, rgba(0, 0, 0, 1) 70%)`;
      }

      handleClick(e) {
        this.createClickWave(e.clientX, e.clientY);
      }

      createClickWave(x, y) {
        const wave = document.createElement('div');
        wave.className = 'click-wave';
        wave.style.left = (x - 50) + 'px';
        wave.style.top = (y - 50) + 'px';
        document.body.appendChild(wave);
        
        setTimeout(() => wave.remove(), 600);
      }

      toggleAudio() {
        if (this.audioPlaying) {
          this.audio.pause();
          this.btnAudio.textContent = "🔈";
        } else {
          this.audio.play().catch(e => console.log('Erro ao reproduzir áudio:', e));
          this.btnAudio.textContent = "🔊";
        }
        this.audioPlaying = !this.audioPlaying;
      }

      toggleFullscreen() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(e => console.log('Erro ao entrar em tela cheia:', e));
          this.btnFullscreen.textContent = "🗗";
        } else {
          document.exitFullscreen();
          this.btnFullscreen.textContent = "⛶";
        }
      }

      toggleAnimations() {
        const playState = this.animationsPaused ? 'running' : 'paused';
        document.documentElement.style.setProperty('animation-play-state', playState);
        
        document.querySelectorAll('*').forEach(el => {
          el.style.animationPlayState = playState;
        });
        
        this.btnPause.textContent = this.animationsPaused ? "⏸️" : "▶️";
        this.animationsPaused = !this.animationsPaused;
      }

      handleMoonClick() {
        this.lua.style.animation = 'aparecerLua 1s ease-in, pulsarLua 2s infinite ease-in-out 1s';
        
        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            this.createParticle(
              this.lua.offsetLeft + this.lua.offsetWidth / 2,
              this.lua.offsetTop + this.lua.offsetHeight / 2
            );
          }, i * 50);
        }

        this.showCustomPhrase("A lua nos conecta, não importa a distância. 🌙");
      }

      handleBoatClick() {
        this.barco.style.animation = 'flutuar 1s ease-in-out, flutuar 3s infinite ease-in-out 1s';
        
        const phrases = [
          "Navegando pelos pensamentos...",
          "Mesmo separados, compartilhamos esta vista.",
          "As ondas sussurram segredos antigos."
        ];
        
        const phrase = phrases[Math.floor(Math.random() * phrases.length)];
        this.showCustomPhrase(phrase);
      }

      createParticle(x, y) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        document.body.appendChild(particle);
        
        const vx = (Math.random() - 0.5) * 4;
        const vy = -Math.random() * 4 - 1;
        const gravity = 0.1;
        
        let posX = x, posY = y;
        let velX = vx, velY = vy;
        
        const animate = () => {
          posX += velX;
          posY += velY;
          velY += gravity;
          
          particle.style.left = posX + 'px';
          particle.style.top = posY + 'px';
          particle.style.opacity = Math.max(0, 1 - posY / window.innerHeight);
          
          if (posY < window.innerHeight && parseFloat(particle.style.opacity) > 0) {
            requestAnimationFrame(animate);
          } else {
            particle.remove();
          }
        };
        
        animate();
      }

      sendLight() {
        this.drawHeart();
      }

      drawHeart() {
        this.resizeCanvas(this.heartCanvas);
        
        const particles = [];
        const centerX = this.heartCanvas.width / 2;
        const centerY = this.heartCanvas.height / 2;
        
        // Criar partículas do coração
        for (let i = 0; i < 300; i++) {
          const t = Math.PI * 2 * (i / 300);
          const pos = this.generateHeart(t);
          particles.push({
            x: centerX + pos.x * (window.innerWidth > 768 ? 15 : 10),
            y: centerY - pos.y * (window.innerWidth > 768 ? 15 : 10),
            r: Math.random() * 3 + 1,
            alpha: 0,
            targetAlpha: 0.5 + Math.random() * 0.5,
            pulse: Math.random() * Math.PI * 2,
            color: `hsl(${320 + Math.random() * 40}, 100%, ${60 + Math.random() * 20}%)`
          });
        }

        let frame = 0;
        const animate = () => {
          this.heartCtx.clearRect(0, 0, this.heartCanvas.width, this.heartCanvas.height);
          frame++;

          particles.forEach(p => {
            p.pulse += 0.1;
            p.alpha += (p.targetAlpha - p.alpha) * 0.05;
            
            const pulseAlpha = p.alpha * (0.8 + 0.2 * Math.sin(p.pulse));
            
            this.heartCtx.beginPath();
            this.heartCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            this.heartCtx.fillStyle = p.color.replace('hsl', 'hsla').replace(')', `, ${pulseAlpha})`);
            this.heartCtx.fill();
            
            if (pulseAlpha > 0.6) {
              this.heartCtx.beginPath();
              this.heartCtx.arc(p.x, p.y, p.r * 2, 0, Math.PI * 2);
              this.heartCtx.fillStyle = p.color.replace('hsl', 'hsla').replace(')', `, ${(pulseAlpha - 0.6) * 0.3})`);
              this.heartCtx.fill();
            }
          });

          if (frame < 120) {
            requestAnimationFrame(animate);
          } else {
            setTimeout(() => this.showLightMessage(), 1000);
          }
        };

        this.heartCanvas.style.display = "block";
        animate();
      }

      generateHeart(t) {
        const x = 16 * Math.pow(Math.sin(t), 3);
        const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
        return { x, y };
      }

      showLightMessage() {
        const name = prompt("Para quem você quer enviar essa luz?");
        const text = name 
          ? `Essa luz é para você, <strong>${this.escapeHtml(name)}</strong>!<br><br>Que ela ilumine seus caminhos e traga paz ao seu coração. 🌙✨`
          : `Essa luz é para você, <strong>alguém especial</strong>!<br><br>Que ela ilumine seus caminhos e traga paz ao seu coração. 🌙✨`;
        
        this.textoLuz.innerHTML = text;
        this.mensagemLuz.style.display = "block";
        this.mensagemLuz.setAttribute('aria-hidden', 'false');
        
        setTimeout(() => {
          this.heartCanvas.style.display = "none";
          this.heartCtx.clearRect(0, 0, this.heartCanvas.width, this.heartCanvas.height);
        }, 3000);
      }

      escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      closeLightModal() {
        this.mensagemLuz.classList.add('close');
        setTimeout(() => {
          this.mensagemLuz.style.display = "none";
          this.mensagemLuz.classList.remove('close');
          this.mensagemLuz.setAttribute('aria-hidden', 'true');
        }, 600);
      }

      handleModalClick(e) {
        if (e.target === this.mensagemLuz) {
          this.closeLightModal();
        }
      }

      handleKeydown(e) {
        switch(e.key) {
          case 'Escape':
            if (this.mensagemLuz.style.display === 'block') this.closeLightModal();
            break;
          case ' ':
            e.preventDefault();
            this.toggleAnimations();
            break;
          case 'm':
          case 'M':
            this.toggleAudio();
            break;
          case 'f':
          case 'F':
            this.toggleFullscreen();
            break;
          case 'l':
          case 'L':
            this.sendLight();
            break;
        }
      }

      touchStartTime = 0;

      handleTouchStart(e) {
        this.touchStartTime = Date.now();
      }

      handleTouchEnd(e) {
        const touchDuration = Date.now() - this.touchStartTime;
        
        if (touchDuration > 500) {
          const touch = e.changedTouches[0];
          for (let i = 0; i < 10; i++) {
            setTimeout(() => {
              this.createParticle(touch.clientX, touch.clientY);
            }, i * 100);
          }
        }
      }

      handleResize() {
        this.resizeCanvas(this.starsCanvas);
        this.resizeCanvas(this.heartCanvas);
      }

      handleOrientationChange() {
        setTimeout(() => {
          this.handleResize();
        }, 100);
      }

      handleVisibilityChange() {
        if (document.hidden) {
          this.isVisible = false;
          if (this.audioPlaying) {
            this.audio.pause();
          }
        } else {
          this.isVisible = true;
          if (this.audioPlaying) {
            this.audio.play().catch(e => console.log('Erro ao retomar áudio'));
          }
        }
      }

      initAudio() {
        this.audio.play().then(() => {
          this.audioPlaying = true;
          this.btnAudio.textContent = "🔊";
        }).catch(e => {
          console.log('Áudio será reproduzido após interação');
        });
      }

      resizeCanvas(canvas) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      initializeStars() {
        this.resizeCanvas(this.starsCanvas);
        this.stars = [];
        this.meteors = [];

        for (let i = 0; i < 50; i++) {
          this.stars.push(this.createStar());
        }

        setInterval(() => {
          if (Math.random() < 0.1 && this.meteors.length < 3) {
            this.meteors.push(this.createMeteor());
          }
        }, 2000);

        this.animateStars();
      }

      createStar() {
        return {
          x: Math.random() * this.starsCanvas.width,
          y: Math.random() * this.starsCanvas.height * 0.6,
          vx: -0.5 - Math.random() * 1,
          vy: 0.5 + Math.random() * 1,
          size: 1 + Math.random() * 2,
          brightness: 0.3 + Math.random() * 0.7,
          twinkle: Math.random() * Math.PI * 2
        };
      }

      createMeteor() {
        return {
          x: Math.random() * this.starsCanvas.width,
          y: 0,
          vx: -2 - Math.random() * 3,
          vy: 1 + Math.random() * 2,
          size: 1 + Math.random() * 2,
          life: 100,
          trail: []
        };
      }

      animateStars() {
        this.starsCtx.clearRect(0, 0, this.starsCanvas.width, this.starsCanvas.height);
        
        // Desenhar estrelas
        this.stars.forEach((star, i) => {
          star.twinkle += 0.05;
          const brightness = star.brightness * (0.5 + 0.5 * Math.sin(star.twinkle));
          
          this.starsCtx.beginPath();
          this.starsCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
          this.starsCtx.fillStyle = `rgba(255, 255, 255, ${brightness})`;
          this.starsCtx.fill();
          
          if (brightness > 0.8) {
            this.starsCtx.beginPath();
            this.starsCtx.arc(star.x, star.y, star.size * 2, 0, Math.PI * 2);
            this.starsCtx.fillStyle = `rgba(255, 255, 255, ${(brightness - 0.8) * 0.3})`;
            this.starsCtx.fill();
          }
          
          star.x += star.vx;
          star.y += star.vy;
          
          if (star.x < -10 || star.y > this.starsCanvas.height + 10) {
            this.stars[i] = this.createStar();
          }
        });
        
        // Desenhar meteoros
        this.meteors.forEach((meteor, i) => {
          meteor.trail.push({x: meteor.x, y: meteor.y});
          if (meteor.trail.length > 10) meteor.trail.shift();
          
          meteor.trail.forEach((pos, j) => {
            const alpha = j / meteor.trail.length * 0.8;
            this.starsCtx.beginPath();
            this.starsCtx.arc(pos.x, pos.y, meteor.size * (j / meteor.trail.length), 0, Math.PI * 2);
            this.starsCtx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
            this.starsCtx.fill();
          });
          
          meteor.x += meteor.vx;
          meteor.y += meteor.vy;
          meteor.life--;
          
          if (meteor.life <= 0 || meteor.x < -10 || meteor.y > this.starsCanvas.height + 10) {
            this.meteors.splice(i, 1);
          }
        });
        
        if (this.isVisible) {
          requestAnimationFrame(() => this.animateStars());
        }
      }

      initializePhrases() {
        this.phrases = [
          "Será que alguém está olhando para a mesma lua, neste exato momento?",
          "Gosto disso... conectados pela luz.",
          "Às vezes, na escuridão, encontramos a verdadeira luz.",
          "A distância não diminui a beleza compartilhada.",
          "Abraçar a família que escolhemos.",
          "Talvez, um dia, não muito distante... encontraremos a paz.",
          "Tudo começa com um momento de contemplação.",
          "A vida não precisa ser perfeita... só precisa ser vivida."
        ];

        setTimeout(() => this.showPhrase(), 3000);
      }

      showPhrase() {
        this.frasesContainer.style.opacity = 0;

        setTimeout(() => {
          this.frasesContainer.textContent = this.phrases[this.currentPhraseIndex];
          this.frasesContainer.style.opacity = 1;

          setTimeout(() => {
            this.frasesContainer.style.opacity = 0;
            this.currentPhraseIndex++;
            
            if (this.currentPhraseIndex < this.phrases.length) {
              setTimeout(() => this.showPhrase(), 2000);
            } else {
              setTimeout(() => {
                this.currentPhraseIndex = 0;
                this.showPhrase();
              }, 10000);
            }
          }, 4000);
        }, 1000);
      }

      showCustomPhrase(phrase) {
        const temp = this.frasesContainer.textContent;
        this.frasesContainer.style.opacity = 0;
        
        setTimeout(() => {
          this.frasesContainer.textContent = phrase;
          this.frasesContainer.style.opacity = 1;
          
          setTimeout(() => {
            this.frasesContainer.style.opacity = 0;
            setTimeout(() => {
              this.frasesContainer.textContent = temp;
              this.frasesContainer.style.opacity = 1;
            }, 1000);
          }, 3000);
        }, 500);
      }

      hideLoading() {
        setTimeout(() => {
          this.loading.classList.add('hide');
          setTimeout(() => {
            this.loading.style.display = 'none';
          }, 1000);
        }, 2000);
      }
    }

    // Inicializar aplicação quando DOM estiver pronto
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => new ConectadosPelaLuz());
    } else {
      new ConectadosPelaLuz();
    }
  </script>
</body>
</html>